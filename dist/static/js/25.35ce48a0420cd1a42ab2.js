webpackJsonp([25],{Av3K:function(t,a,e){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var s=e("Xxa5"),i=e.n(s),n=e("woOf"),o=e.n(n),r=e("exGp"),c=e.n(r),l={name:"MatchManage",data:function(){return{centerDialogVisible:!1,roles:1,postData:{matchType:"",pageNo:1,pageSize:30},form:{startTime:"",endTime:"",matchName:"",theoryFlag:0},renderList:[],pickerOptions:{disabledDate:function(t){return t.getTime()<Date.now()-864e5}}}},methods:{goBack:function(){this.$router.push({path:"./Home"}),sessionStorage.setItem("MatchManageType","")},getTeachMatchList:function(){var t=this;return c()(i.a.mark(function a(){var e,s;return i.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return e=o()({},t.postData),a.next=3,t.$axios.getTeachMatchList(e);case 3:1e3==(s=a.sent).code?t.renderList=s.data?s.data:[]:t.renderList=[];case 5:case"end":return a.stop()}},a,t)}))()},getStuMatchList:function(){var t=this;return c()(i.a.mark(function a(){var e,s;return i.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return(e={}).status=t.postData.matchType,e.pageNum=t.postData.pageNo,e.pageSize=t.postData.pageSize,a.next=6,t.$axios.getStuMatchList(e);case 6:1e3==(s=a.sent).code?t.renderList=s.data?s.data:[]:t.renderList=[];case 8:case"end":return a.stop()}},a,t)}))()},onLinkTestList:function(t){var a="";1==this.postData.matchType&&(a="&matchType="+this.postData.matchType),this.$router.push({path:"./AssessmentGame?matchId="+t+a})},onLinkGroupList:function(t){this.hasQx("teach:match:groupList")||this.hasQx("stu:match:group")?this.$router.push({path:"./GroupList?matchId="+t}):this.dialog("您无权进行该操作")},tabChange:function(t){this.postData.matchType=t,sessionStorage.setItem("MatchManageType",t),1==this.roles?this.getTeachMatchList():this.getStuMatchList()},addMatchManage:function(){var t=this;return c()(i.a.mark(function a(){var e,s,n;return i.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(""!=t.form.startTime){a.next=3;break}return t.dialog("开始时间不能为空"),a.abrupt("return",!1);case 3:if(""!=t.form.endTime){a.next=6;break}return t.dialog("结束时间不能为空"),a.abrupt("return",!1);case 6:if(""!=t.form.matchName){a.next=9;break}return t.dialog("比赛主题不能为空"),a.abrupt("return",!1);case 9:if(!(Date.parse(t.form.startTime)<Date.now())){a.next=12;break}return t.dialog("比赛开始时间不能小于当前时间"),a.abrupt("return",!1);case 12:return e=o()({},t.form),a.next=15,t.$axios.editTeachMath(e);case 15:1e3==(s=a.sent).code?((n={}).matchId=s.data.matchId,n.matchTime=t.form.startTime+t.form.endTime,n.matchStatus=0,n.matchTitle=t.form.matchName,t.renderList.unshift(n),t.centerDialogVisible=!1,t.form={startTime:"",endTime:"",matchName:"",theoryFlag:0}):t.dialog(s.message);case 17:case"end":return a.stop()}},a,t)}))()},resetForm:function(){this.form={startTime:"",endTime:"",matchName:"",theoryFlag:0},this.centerDialogVisible=!1},onChangeTime:function(){this.form.startTime&&this.form.endTime&&Date.parse(this.form.startTime)>Date.parse(this.form.endTime)&&(this.dialog("结束时间不能小于开始时间"),this.form.startTime="")},downloadResult:function(t,a){var e=this;return c()(i.a.mark(function s(){var n,o,r,c;return i.a.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return n={matchId:t},s.next=3,e.$axios.exportMatchResult(n);case 3:if(o=s.sent){s.next=6;break}return s.abrupt("return");case 6:r=window.URL.createObjectURL(new Blob([o])),(c=document.createElement("a")).style.display="none",c.href=r,c.setAttribute("download",a+"比赛结果.xls"),document.body.appendChild(c),c.click(),c.parentNode.removeChild(c);case 14:case"end":return s.stop()}},s,e)}))()}},mounted:function(){var t=this;this.postData.matchType=sessionStorage.getItem("MatchManageType")||0,this.hasQx("teach:match:list")?(this.roles=1,this.getTeachMatchList()):this.hasQx("stu:match:list")?(this.roles=2,this.getStuMatchList()):this.dialog("您无权进行该操作",function(){t.$router.push({path:"Home"})})}},m={render:function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"matchManage"},[e("Header",{attrs:{title:"比赛管理"},on:{goBack:t.goBack}}),e("div",{staticClass:"contentDiv"},[1===t.roles?e("el-row",{staticClass:"tab-cont"},[e("el-col",{attrs:{span:8}},[e("div",{staticClass:"tab",class:0==t.postData.matchType?"on":"",on:{click:function(a){t.tabChange(0)}}},[t._v("待开始")])]),t._v(" "),e("el-col",{attrs:{span:8}},[e("div",{staticClass:"tab",class:1==t.postData.matchType?"on":"",on:{click:function(a){t.tabChange(1)}}},[t._v("进行中")])]),t._v(" "),e("el-col",{attrs:{span:8}},[e("div",{staticClass:"tab",class:2==t.postData.matchType?"on":"",on:{click:function(a){t.tabChange(2)}}},[t._v("已结束")])])],1):t._e(),t._v(" "),2===t.roles?e("el-row",{staticClass:"tab-cont"},[e("el-col",{attrs:{span:12}},[e("div",{staticClass:"tab",class:0==t.postData.matchType?"on":"",on:{click:function(a){t.tabChange(0)}}},[t._v("进行中")])]),t._v(" "),e("el-col",{attrs:{span:12}},[e("div",{staticClass:"tab",class:1==t.postData.matchType?"on":"",on:{click:function(a){t.tabChange(1)}}},[t._v("已结束")])])],1):t._e(),t.renderList.length>0?e("div",{staticClass:"scroll-div"},[1==t.roles?e("ul",{staticClass:"teach match-list"},t._l(t.renderList,function(a,s){return e("li",{key:a.matchId,staticClass:"item",on:{click:function(e){t.onLinkGroupList(a.matchId)}}},[e("div",{staticClass:"match-name"},[e("span",[t._v(t._s(a.matchTitle))]),e("span",{staticClass:"time"},[t._v(t._s(a.matchTime))])]),e("div",{staticClass:"check-group"},[0==a.matchStatus&&t.hasQx("teach:match:edit")?e("el-button",{attrs:{plain:"",round:""}},[t._v("编辑比赛")]):t._e(),t._v(" "),2==a.matchStatus&&t.hasQx("teach:match:exportExcel")?e("el-button",{attrs:{plain:"",round:""},on:{click:function(e){e.stopPropagation(),t.downloadResult(a.matchId,a.matchTitle)}}},[t._v("导出比赛结果")]):t._e()],1)])})):e("ul",{staticClass:"stu match-list"},t._l(t.renderList,function(a,s){return e("li",{key:a.matchId,staticClass:"item"},[e("div",{staticClass:"match-name"},[e("span",[t._v(t._s(a.matchTitle))]),e("span",{staticClass:"time"},[t._v(t._s(a.matchTime))])]),e("div",{staticClass:"check-group"},[0==t.postData.matchType||t.hasQx("stu:match:group")?e("el-button",{attrs:{plain:"",round:""},on:{click:function(e){t.onLinkGroupList(a.matchId)}}},[t._v("比赛分组")]):t._e(),t._v(" "),0==t.postData.matchType&&t.hasQx("stu:match:testList")?e("el-button",{attrs:{plain:"",round:""},on:{click:function(e){t.onLinkTestList(a.matchId)}}},[t._v("考试答题")]):t._e(),t._v(" "),1==t.postData.matchType&&t.hasQx("stu:match:testList")?e("el-button",{attrs:{plain:"",round:""},on:{click:function(e){t.onLinkTestList(a.matchId)}}},[t._v("查看结果")]):t._e()],1)])}))]):t._e(),0===t.renderList.length?e("NotInfo",{attrs:{notClass:"暂无相关数据",defaultImg:"static/img/not-data-default.png"}}):t._e()],1),t.hasQx("teach:match:edit")?e("div",{staticClass:"addMatch-cont",on:{click:function(a){t.centerDialogVisible=!0}}},[t._m(0)]):t._e(),t.hasQx("teach:match:edit")?e("div",{staticClass:"dialogBox"},[e("el-dialog",{attrs:{title:"添加比赛",visible:t.centerDialogVisible,width:"50%",center:""},on:{"update:visible":function(a){t.centerDialogVisible=a}}},[e("el-form",{ref:"form",attrs:{"label-position":"top",model:t.form,"label-width":"80px"}},[e("el-form-item",{attrs:{label:"比赛时间"}},[e("el-col",{attrs:{span:11}},[e("el-date-picker",{attrs:{type:"datetime","value-format":"yyyy-MM-dd HH:mm:ss",placeholder:"开始时间","picker-options":t.pickerOptions},on:{change:t.onChangeTime},model:{value:t.form.startTime,callback:function(a){t.$set(t.form,"startTime",a)},expression:"form.startTime"}})],1),t._v(" "),e("el-col",{staticClass:"line",attrs:{span:2}},[t._v("至")]),t._v(" "),e("el-col",{attrs:{span:11}},[e("el-date-picker",{attrs:{type:"datetime","value-format":"yyyy-MM-dd HH:mm:ss",placeholder:"结束时间","picker-options":t.pickerOptions},on:{change:t.onChangeTime},model:{value:t.form.endTime,callback:function(a){t.$set(t.form,"endTime",a)},expression:"form.endTime"}})],1)],1),t._v(" "),e("el-form-item",{attrs:{label:"主题"}},[e("el-input",{model:{value:t.form.matchName,callback:function(a){t.$set(t.form,"matchName",a)},expression:"form.matchName"}})],1),t._v(" "),e("el-form-item",{staticClass:"theory-item",attrs:{label:"理论考试"}},[e("el-checkbox",{attrs:{label:"有","true-label":"1","false-label":"0"},model:{value:t.form.theoryFlag,callback:function(a){t.$set(t.form,"theoryFlag",a)},expression:"form.theoryFlag"}})],1)],1),t._v(" "),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{attrs:{type:"primary"},on:{click:t.addMatchManage}},[t._v("新 增")]),t._v(" "),e("el-button",{on:{click:function(a){t.resetForm()}}},[t._v("取 消")])],1)],1)],1):t._e()],1)},staticRenderFns:[function(){var t=this.$createElement,a=this._self._c||t;return a("div",{staticClass:"add-btn"},[a("span",{staticClass:"el-icon-plus avatar-uploader-icon"}),a("span",[this._v("新增比赛")])])}]};var h=e("VU/8")(l,m,!1,function(t){e("Rfvf")},null,null);a.default=h.exports},Rfvf:function(t,a){}});