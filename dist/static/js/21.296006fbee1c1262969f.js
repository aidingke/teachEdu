webpackJsonp([21],{H0HA:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=s("Xxa5"),r=s.n(a),i=s("exGp"),l=s.n(i),o={name:"ClassTable",components:{SuccessTip:s("0b0c").default},data:function(){return{timer:null,data:[],screenWidth:document.body.clientWidth,subjectDisabled:!1,teacherDiabled:!1,hint:"课程表",tip:"课程添加成功",th:["","周一","周二","周三","周四","周五","周六","周日"],tr:[new Array(8),new Array(8),new Array(8),new Array(8),new Array(8),new Array(8),new Array(8),new Array(8)],classTableList:[],dialogVisible:!1,labelPosition:"top",colors:["#F65939","#4FB6E1","#5FB39D","#F4BE5C","#67C23A","#7A9AE5"],formLabelAlign:{classId:this.$route.query.classId,subjectId:this.$route.query.subjectId,teachId:"",courseDate:"",courseTime:"",startTime:"",endTime:"",color:""},rules:{teachId:[{required:!0,message:"请选择上课老师",trigger:"change"}],courseDate:[{required:!0,message:"请选择上课日期",trigger:"change"}],startTime:[{required:!0,message:"请选择开始上课时间",trigger:"change"}],endTime:[{required:!0,message:"请选择结束上课时间",trigger:"change"}]},teacherList:[],courseList:[],courseStartTime:[{value:1,label:1},{value:2,label:2},{value:3,label:3},{value:4,label:4},{value:5,label:5},{value:6,label:6},{value:7,label:7},{value:8,label:8}],courseEndTime:[{value:1,label:1},{value:2,label:2},{value:3,label:3},{value:4,label:4},{value:5,label:5},{value:6,label:6},{value:7,label:7},{value:8,label:8}],showDialogTableVisible:!1,warningText:"课程添加成功",flagImg:!1,courseId:"",myCourses:!0}},methods:{resetForm:function(e){this.dialogVisible=!1,this.$refs[e].resetFields(),this.deleteDisabled()},done:function(){this.showDialogTableVisible=!1,this.getCourseList()},goBack:function(){this.$router.go(-1)},isFlagImg:function(){0===this.classTableList.length?this.dialog("暂无可删除的课程"):this.flagImg=!0},deleteCourse:function(e){this.classTableList=this.classTableList.filter(function(t,s){return t.courseId!=e.courseId}),""===this.courseId?this.courseId=e.courseId:this.courseId+=","+e.courseId,this.renderCourseList()},deleteDisabled:function(){for(var e=0;e<8;e++)this.$delete(this.courseEndTime[e],"disabled"),this.$delete(this.courseStartTime[e],"disabled")},setDisabled:function(e){if(this.deleteDisabled(),e===this.courseStartTime)for(var t=0;t<this.formLabelAlign.startTime;t++){if(t+1===this.formLabelAlign.startTime)return;this.courseEndTime[t].disabled=!0}else if(e===this.courseEndTime)for(var s=this.formLabelAlign.endTime;s<8;s++)this.courseStartTime[s].disabled=!0},renderCourseList:function(){for(var e=0;e<this.classTableList.length;e++){var t=this.classTableList[e],s=document.querySelector(".profess-th__"+t.courseDate),a=document.querySelector(".profess-tr__"+(t.courseTime[0]-1)),r=s.getBoundingClientRect(),i=(a.getBoundingClientRect(),t.courseTime[1]-t.courseTime[0]+1),l=document.querySelector(".profess-cont__"+e);l.style.left=r.left+"px",l.style.top=a.offsetTop+"px",l.style.width=r.width+"px",l.style.height=82*i+"px",l.style.backgroundColor=t.color}},validate:function(e){var t=this;this.$refs[e].validate(function(e){if(!e)return!1;t.addCourse()})},getColor:function(){var e=this.formLabelAlign,t=this.colors;switch(e.courseDate){case 1:e.color=t[0];break;case 2:e.color=t[1];break;case 3:e.color=t[2];break;case 4:e.color=t[3];break;case 5:e.color=t[4];break;case 6:case 7:e.color=t[5];break;default:e.color=t[0]}},forbidFocus:function(e){document.querySelector("#id").focus(function(){document.activeElement.blur()})},getSubjectList:function(){var e=this;return l()(r.a.mark(function t(){var s;return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.$axios.getSubjectList({pageNo:1,pageSize:0});case 2:if(1e3!==(s=t.sent).code){t.next=7;break}e.courseList=s.data,t.next=12;break;case 7:if(1100!==s.code){t.next=11;break}return t.abrupt("return");case 11:e.dialog(s.message);case 12:case"end":return t.stop()}},t,e)}))()},getCourseList:function(){var e=this;return l()(r.a.mark(function t(){var s,a,i,l,o,n,c;return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!(s={classId:e.$route.query.classId,subjectId:e.$route.query.subjectId}).classId||!s.subjectId){t.next=8;break}return t.next=4,e.$axios.getCourseList(s);case 4:a=t.sent,e.data=a,t.next=19;break;case 8:if(!s.classId){t.next=15;break}return t.next=11,e.$axios.teachClassCouresList(s);case 11:i=t.sent,e.data=i,t.next=19;break;case 15:return t.next=17,e.$axios.getTeachCourseList();case 17:l=t.sent,e.data=l;case 19:if(1e3!==e.data.code){t.next=26;break}for("Array"===(o=Object.prototype.toString.call(e.data.data).slice(8,-1))?e.data.data.length>=0&&(e.classTableList=e.data.data):"Object"===o&&(e.classTableList=e.data.data.courseList,e.formLabelAlign.teachId=e.data.data.teachId),n=0;n<e.classTableList.length;n++)(c=e.classTableList[n]).courseTime=""===c.courseTime?[]:c.courseTime.split("-"),c.courseDate=""===c.courseDate?0:Number(c.courseDate);e.$nextTick(function(){this.renderCourseList()}),t.next=31;break;case 26:if(1100!==res.code){t.next=30;break}return t.abrupt("return");case 30:e.dialog(res.message);case 31:case"end":return t.stop()}},t,e)}))()},addCourse:function(e){var t=this;return l()(r.a.mark(function e(){var s,a,i;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return(a=(s=t).formLabelAlign).courseTime=a.startTime+"-"+a.endTime,t.getColor(),e.next=6,s.$axios.addCourse(a);case 6:1e3===(i=e.sent).code?(t.showDialogTableVisible=!0,t.dialogVisible=!1,t.deleteDisabled()):t.dialog(i.message);case 8:case"end":return e.stop()}},e,t)}))()},getTeachList:function(){var e=this;return l()(r.a.mark(function t(){var s;return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e.dialogVisible=!0,e.getSubjectList(),t.next=4,e.$axios.getTeachList();case 4:if(!(1e3===(s=t.sent).code&&s.data.length>0)){t.next=9;break}e.teacherList=s.data,t.next=14;break;case 9:if(1100!==s.code){t.next=13;break}return t.abrupt("return");case 13:e.dialog(s.message);case 14:case"end":return t.stop()}},t,e)}))()},courseDelete:function(){var e=this;return l()(r.a.mark(function t(){var s;return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e.flagImg=!1,""!==e.courseId){t.next=3;break}return t.abrupt("return");case 3:return t.next=5,e.$axios.courseDelete({courseIds:e.courseId});case 5:1e3===(s=t.sent).code?(e.successMsg("删除课程成功"),e.getCourseList()):e.dialog(s.message);case 7:case"end":return t.stop()}},t,e)}))()}},watch:{screenWidth:function(e){if(!this.timer){this.screenWidth=e,this.timer=!0;var t=this;setTimeout(function(){t.renderCourseList(),t.timer=!1},0)}}},mounted:function(){var e=this.$route.query;e.classId&&e.subjectId?(this.subjectDisabled=!0,this.myCourses=!0):e.classId?this.myCourses=!0:(this.teacherDiabled=!0,this.myCourses=!1),this.getCourseList();var t=this;window.onresize=function(){return window.screenWidth=document.body.clientWidth,void(t.screenWidth=window.screenWidth)}}},n={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"table"},[s("Header",{attrs:{title:"课程表"},on:{goBack:e.goBack}}),s("SuccessTip",{attrs:{dialogTableVisible:e.showDialogTableVisible,tip:e.tip,hint:e.hint},on:{successDone:e.done}}),s("el-dialog",{attrs:{title:"添加课程",visible:e.dialogVisible,width:"50%"},on:{"update:visible":function(t){e.dialogVisible=t},close:function(t){e.resetForm("formLabelAlign")}}},[s("el-form",{ref:"formLabelAlign",attrs:{"label-position":e.labelPosition,"label-width":"80px",model:e.formLabelAlign,rules:e.rules}},[s("el-form-item",{attrs:{label:"上课日期",prop:"courseDate"}},[s("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择课节",id:"courseDate"},on:{click:function(t){e.forbidFocus("courseDate")}},model:{value:e.formLabelAlign.courseDate,callback:function(t){e.$set(e.formLabelAlign,"courseDate",t)},expression:"formLabelAlign.courseDate"}},e._l(e.th,function(t,a){return 0!==a?s("el-option",{key:t,attrs:{label:t,value:a}}):e._e()}))],1),e._v(" "),s("el-form-item",{attrs:{label:"上课时间"}},[s("el-col",{attrs:{span:11}},[s("el-form-item",{attrs:{prop:"startTime"}},[s("el-select",{attrs:{placeholder:"请选择课节"},on:{change:function(t){e.setDisabled(e.courseStartTime)}},model:{value:e.formLabelAlign.startTime,callback:function(t){e.$set(e.formLabelAlign,"startTime",t)},expression:"formLabelAlign.startTime"}},e._l(e.courseStartTime,function(e){return s("el-option",{key:e.value,attrs:{label:e.label,value:e.value,disabled:e.disabled}})}))],1)],1),s("el-col",{staticClass:"utils",attrs:{span:2}},[e._v("至")]),s("el-col",{attrs:{span:11}},[s("el-form-item",{attrs:{prop:"endTime"}},[s("el-select",{attrs:{placeholder:"请选择课节"},on:{change:function(t){e.setDisabled(e.courseEndTime)}},model:{value:e.formLabelAlign.endTime,callback:function(t){e.$set(e.formLabelAlign,"endTime",t)},expression:"formLabelAlign.endTime"}},e._l(e.courseEndTime,function(e){return s("el-option",{key:e.value,attrs:{label:e.label,value:e.value,disabled:e.disabled}})}))],1)],1)],1),e._v(" "),s("el-form-item",{attrs:{label:"科目",prop:"subjectId"}},[s("el-select",{attrs:{placeholder:"科目",disabled:e.subjectDisabled},model:{value:e.formLabelAlign.subjectId,callback:function(t){e.$set(e.formLabelAlign,"subjectId",t)},expression:"formLabelAlign.subjectId"}},e._l(e.courseList,function(e){return s("el-option",{key:e.id,attrs:{label:e.subjectName,value:e.id}})}))],1),e._v(" "),s("el-form-item",{attrs:{label:"上课老师",prop:"teachId"}},[s("el-select",{attrs:{placeholder:"上课老师",disabled:e.teacherDiabled},model:{value:e.formLabelAlign.teachId,callback:function(t){e.$set(e.formLabelAlign,"teachId",t)},expression:"formLabelAlign.teachId"}},e._l(e.teacherList,function(e){return s("el-option",{key:e.id,attrs:{label:e.teachName,value:e.id}})}))],1)],1),s("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{attrs:{type:"primary"},on:{click:function(t){e.validate("formLabelAlign")}}},[e._v("添加")]),e._v(" "),s("el-button",{on:{click:function(t){e.resetForm("formLabelAlign")}}},[e._v("取 消")])],1)],1),s("div",{staticClass:"container"},[s("div",{staticClass:"box"},[s("table",[s("thead",[s("tr",e._l(e.th,function(t,a){return s("th",{key:a,class:"profess-th__"+a},[e._v(e._s(t))])}))]),s("tbody",e._l(e.tr,function(t,a){return s("tr",{key:a,class:"profess-tr__"+a},[e._l(t,function(t,r){return a===r?s("td",{key:t,class:"profess-td__"+r},[e._v(e._s(a+1))]):e._e()}),e._l(t,function(t,r){return a!==r?s("td",{key:t,class:"profess-td__"+r}):e._e()})],2)}))]),e._l(e.classTableList,function(t,a){return s("div",{key:a,class:"profess-cont profess-cont__"+a},[s("div",{staticStyle:{display:"table-cell","vertical-align":"middle",width:"100%",height:"100%",overflow:"hidden"}},[s("span",{staticClass:"profess-name"},[e._v(e._s(t.subjectName))]),s("span",{staticClass:"profess-name profess-name1"},[e._v(e._s(t.className))]),s("span",{directives:[{name:"show",rawName:"v-show",value:e.flagImg,expression:"flagImg"}],staticClass:"el-icon-close class-name",on:{click:function(s){e.deleteCourse(t)}}})])])}),e.myCourses?s("div",{staticClass:"button-submit"},[s("el-button",{directives:[{name:"show",rawName:"v-show",value:!e.flagImg,expression:"!flagImg"}],attrs:{type:"primary"},on:{click:e.getTeachList}},[e._v("添加课程")]),s("el-button",{directives:[{name:"show",rawName:"v-show",value:!e.flagImg,expression:"!flagImg"}],attrs:{plain:"plain"},on:{click:e.isFlagImg}},[e._v("删除")]),s("el-button",{directives:[{name:"show",rawName:"v-show",value:e.flagImg,expression:"flagImg"}],staticStyle:{width:"96%","margin-left":"0"},attrs:{plain:"plain"},on:{click:e.courseDelete}},[e._v("完成")])],1):e._e()],2)])],1)},staticRenderFns:[]};var c=s("VU/8")(o,n,!1,function(e){s("zagn")},null,null);t.default=c.exports},zagn:function(e,t){}});