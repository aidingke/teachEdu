webpackJsonp([54],{"0K+M":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a("gRE1"),i=a.n(n),s=a("Xxa5"),r=a.n(s),l=a("exGp"),o=a.n(l),c={name:"RoleManage",data:function(){return{checkAll:[],isIndeterminate:!0,dialogTableVisible:!1,roleInput:"",roleId:"",checkList:[],checkedCities:[],title:"",roleList:[],roles:"1",userType:"",validate:{name:{isOK:!0,text:"角色名称不能为空"}}}},methods:{goBack:function(){this.$router.push({path:"Home"})},roleListFun:function(){var e=this;return o()(r.a.mark(function t(){var a;return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.$axios.getRoleList();case 2:a=t.sent,e.roleList=a.data.sort(function(e){if(e.isDefault)return!0}).reverse(),console.log(e.roleList);case 5:case"end":return t.stop()}},t,e)}))()},authority:function(){var e=this;return o()(r.a.mark(function t(){var a;return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.$axios.getPersonPermiss();case 2:1e3===(a=t.sent).code?e.$store.dispatch("getQx",a.data):e.dialog(a.message);case 4:case"end":return t.stop()}},t,e)}))()},submit:function(){var e=this;return o()(r.a.mark(function t(){var a;return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e.roleInput?e.validate.name.isOK=!0:e.validate.name.isOK=!1,0!=e.checkedCities.length){t.next=4;break}return e.dialog("请选择相应权限"),t.abrupt("return");case 4:if(!i()(e.validate).every(function(e){return e.isOK})){t.next=12;break}return a={roleName:e.roleInput,roleType:e.roles,permIds:e.checkedCities.toString()},"编辑权限"==e.title&&(a.roleId=e.roleId),t.next=9,e.$axios.getRoleEdit(a);case 9:1e3===t.sent.code&&(e.roleListFun(),e.authority()),e.dialogTableVisible=!1;case 12:case"end":return t.stop()}},t,e)}))()},handleCheckAllChange:function(e){console.log(e),this.checkedCities=e?this.computedList.map(function(e){return e.permId}):[],this.isIndeterminate=!1},handleCheckedCitiesChange:function(e){console.log(e,"value");var t=e.length;this.checkAll=t===this.checkList.length,this.isIndeterminate=t>0&&t<this.checkList.length},handleDialog:function(e){var t=this;return o()(r.a.mark(function a(){var n;return r.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return t.dialogTableVisible=!0,"add"===e?(t.title="新增角色",t.roleInput="",t.checkedCities=[],t.roles="1",t.checkAll=[]):t.hasQx("teach:role:getInfoById")?(t.title="编辑权限",t.roleId=e,t.getRoleDetail()):t.dialog("您无权进行该操作"),a.next=4,t.$axios.getPermission();case 4:n=a.sent,t.checkList=n.data;case 6:case"end":return a.stop()}},a,t)}))()},getRoleDetail:function(){var e=this;return o()(r.a.mark(function t(){var a,n;return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return a={roleId:e.roleId},t.next=3,e.$axios.getRoleDetail(a);case 3:n=t.sent,e.roleInput=n.data.roleName,e.checkedCities=n.data.permIds.split(","),e.roles=n.data.roleType,console.log(n.data.roleType,"res.data.roleType"),console.log(e.roles,"this.roles");case 9:case"end":return t.stop()}},t,e)}))()},deleCurrentLine:function(e){var t=this;return o()(r.a.mark(function a(){var n;return r.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,t.$axios.getRoleDele({roleId:e});case 2:1e3===(n=a.sent).code?(t.successMsg("操作成功"),t.roleListFun()):t.dialog(n.message);case 4:case"end":return a.stop()}},a,t)}))()}},computed:{computedList:function(){var e=this;return this.checkList.filter(function(t){return"0"===e.roles?/^学生|通用/.test(t.permName):"1"===e.roles?/^教师|通用/.test(t.permName):/^学生|教师|通用/.test(t.permName)})}},mounted:function(){this.roleListFun()}},u={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"role"},[a("Header",{attrs:{title:"角色管理"},on:{goBack:e.goBack}}),a("div",{staticClass:"container"},[a("nav",[a("span",{staticClass:"left"},[e._v("全部角色（"+e._s(e.roleList?e.roleList.length:"")+"）")])]),a("ul",[e._l(e.roleList,function(t,n){return a("li",{key:n},[a("span",{staticClass:"name"},[e._v(e._s(t.roleName))]),a("span",{staticClass:"control"},[e._v("权限（"+e._s(t.permNum)+"）")]),a("img",{attrs:{src:"static/img/edit.png"},on:{click:function(a){e.handleDialog(t.roleId)}}}),t.isDefault?a("span",{staticStyle:{margin:"0 19px"}}):e._e(),a("span",{staticStyle:{margin:"0 20px"}}),!t.isDefault&&e.hasQx("teach:role:delete")?a("img",{attrs:{src:"static/img/dele-item.png"},on:{click:function(a){e.deleCurrentLine(t.roleId)}}}):e._e()])}),e.hasQx("teach:role:edit")?a("el-button",{staticClass:"push",attrs:{type:"primary"},on:{click:function(t){e.handleDialog("add")}}},[e._v("+ 新增角色")]):e._e()],2)]),a("el-dialog",{attrs:{visible:e.dialogTableVisible,width:"545px"},on:{"update:visible":function(t){e.dialogTableVisible=t}}},[a("div",{staticClass:"window"},[a("h3",[e._v(" "+e._s(e.title))]),a("div",{staticClass:"role-name"},[e._v("角色名称 "),a("span",[e._v("*")])]),a("el-input",{attrs:{placeholder:"输入角色名"},model:{value:e.roleInput,callback:function(t){e.roleInput=t},expression:"roleInput"}}),e.validate.name.isOK?e._e():a("div",{staticClass:"validate"},[e._v(e._s(e.validate.name.text))]),a("div",{staticClass:"juris"},[e._v("权限")]),a("el-checkbox",{staticClass:"all",attrs:{indeterminate:e.isIndeterminate},on:{change:e.handleCheckAllChange},model:{value:e.checkAll,callback:function(t){e.checkAll=t},expression:"checkAll"}},[e._v("全选")]),a("el-checkbox-group",{staticClass:"flex-group",on:{change:e.handleCheckedCitiesChange},model:{value:e.checkedCities,callback:function(t){e.checkedCities=t},expression:"checkedCities"}},e._l(e.computedList,function(t){return a("el-checkbox",{key:t.permId,attrs:{label:t.permId}},[e._v(e._s(t.permName))])})),a("div",{staticClass:"button-item"},[a("div",[e.hasQx("teach:role:edit")?a("el-button",{attrs:{type:"primary"},on:{click:e.submit}},[e._v("确定")]):e._e(),a("el-button",{attrs:{plain:""},on:{click:function(t){e.dialogTableVisible=!1}}},[e._v("取消")])],1)])],1)])],1)},staticRenderFns:[]};var d=a("VU/8")(c,u,!1,function(e){a("PUZ0")},null,null);t.default=d.exports},PUZ0:function(e,t){}});